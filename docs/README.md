# ğŸ“š API Documentation Structure

## ğŸ¯ Overview

This folder contains the **source of truth** for all API documentation. The structure follows OpenAPI 3.0 standards with modular YAML files for maintainability and scalability.

---

## ğŸ“ Folder Structure

```
docs/
â”œâ”€â”€ index.yaml                 # ğŸ¯ MASTER FILE - references all modules
â”œâ”€â”€ components/                # Reusable OpenAPI components
â”‚   â”œâ”€â”€ schemas.yaml          # Data models (User, Campaign, etc.)
â”‚   â”œâ”€â”€ responses.yaml        # Common HTTP responses
â”‚   â”œâ”€â”€ parameters.yaml       # Reusable URL/query parameters
â”‚   â””â”€â”€ security.yaml         # Authentication schemes
â””â”€â”€ paths/                    # API endpoint definitions
    â”œâ”€â”€ auth.yaml             # Authentication endpoints
    â”œâ”€â”€ campaigns.yaml        # Campaign management endpoints
    â”œâ”€â”€ admin.yaml            # Admin-only endpoints
    â””â”€â”€ collaborations.yaml   # (future) Collaboration endpoints
```

---

## âœ… Core Principles

### ğŸŸ¢ **ALWAYS EDIT** (Source of Truth)
- âœï¸ `docs/index.yaml` - Master file
- âœï¸ `docs/components/*.yaml` - Schemas, responses, parameters
- âœï¸ `docs/paths/*.yaml` - Individual endpoint definitions

### ğŸ”´ **NEVER EDIT MANUALLY**
- âŒ `swagger-bundled.json` - Auto-generated by build script
- âŒ This file is regenerated on every build

---

## ğŸš€ Quick Start

### 1ï¸âƒ£ Install Dependencies

```bash
npm install -g @apidevtools/swagger-cli
npm install -g @stoplight/spectral-cli
```

### 2ï¸âƒ£ Bundle Documentation

```bash
# Generate bundled JSON from YAML sources
npm run docs:bundle

# Validate OpenAPI spec
npm run docs:validate

# Lint for best practices
npm run docs:lint

# Auto-rebuild on file changes (dev mode)
npm run docs:watch
```

---

## ğŸ“ How to Add New Endpoints

### Step 1: Choose the correct domain file

| Domain | File | Examples |
|--------|------|----------|
| Authentication | `paths/auth.yaml` | Login, signup, sessions |
| Campaigns | `paths/campaigns.yaml` | Create/update campaigns |
| Admin | `paths/admin.yaml` | User management, logs |
| Collaborations | `paths/collaborations.yaml` | Influencer partnerships |

### Step 2: Add endpoint definition

Edit the appropriate file in `docs/paths/`:

```yaml
paths:
  /api/your/endpoint:
    post:
      tags:
        - YourTag
      summary: Brief description
      description: Detailed description
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                field:
                  type: string
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: '../components/schemas.yaml#/schemas/YourSchema'
        '401':
          $ref: '../components/responses.yaml#/responses/UnauthorizedError'
```

### Step 3: Register endpoint in index.yaml

Add the path reference:

```yaml
paths:
  /api/your/endpoint:
    $ref: './paths/yourfile.yaml#/paths/~1api~1your~1endpoint'
```

**Note:** URL path separators `/` are encoded as `~1` in JSON Pointer notation.

### Step 4: Rebuild bundle

```bash
npm run docs:bundle
```

---

## ğŸ”§ Adding New Schemas

Edit `docs/components/schemas.yaml`:

```yaml
schemas:
  YourNewModel:
    type: object
    required:
      - id
      - name
    properties:
      id:
        type: integer
      name:
        type: string
      createdAt:
        type: string
        format: date-time
```

Reference it in endpoints:

```yaml
schema:
  $ref: '../components/schemas.yaml#/schemas/YourNewModel'
```

---

## ğŸ› ï¸ Best Practices

### âœ… DO:
- Edit YAML files in `docs/` folder
- Use `$ref` to avoid duplication
- Run `npm run docs:validate` before committing
- Add descriptions to all endpoints
- Include example values in schemas
- Use semantic HTTP status codes

### âŒ DON'T:
- **Never edit `swagger-bundled.json` directly**
- Don't duplicate schemas (use $ref)
- Don't commit without validating
- Don't use inline schemas for reusable models

---

## ğŸ” Validation & Linting

```bash
# Check if OpenAPI spec is valid
npm run docs:validate

# Check for best practice violations
npm run docs:lint
```

Common validation errors:
- Missing required fields
- Invalid $ref paths
- Incorrect HTTP status codes
- Missing security definitions

---

## ğŸ”— Reference Format Examples

### Schema Reference
```yaml
$ref: '../components/schemas.yaml#/schemas/User'
```

### Response Reference
```yaml
$ref: '../components/responses.yaml#/responses/UnauthorizedError'
```

### Parameter Reference
```yaml
$ref: '../components/parameters.yaml#/parameters/PageNumber'
```

### Path Reference (in index.yaml)
```yaml
/api/auth/login:
  $ref: './paths/auth.yaml#/paths/~1api~1auth~1login'
```

---

## ğŸ“¦ Production Deployment

The bundled file is automatically generated before starting the server:

```json
// package.json
"scripts": {
  "prestart": "npm run docs:bundle",
  "start": "node server.js"
}
```

This ensures the Swagger UI always serves the latest documentation.

---

## ğŸ› Troubleshooting

### Issue: "$ref could not be resolved"
**Solution:** Check file path is relative and uses forward slashes `/`

### Issue: "Validation failed"
**Solution:** Run `npm run docs:validate` to see detailed errors

### Issue: "Bundle command not found"
**Solution:** Install swagger-cli globally: `npm install -g @apidevtools/swagger-cli`

---

## ğŸ“Š Workflow Summary

```mermaid
graph LR
    A[Edit YAML files] --> B[Run docs:validate]
    B --> C[Run docs:bundle]
    C --> D[swagger-bundled.json created]
    D --> E[Commit changes]
    E --> F[Deploy]
```

---

## ğŸ‘¥ Team Guidelines

1. **Before adding endpoints:**
   - Check if the domain file exists
   - Follow naming conventions (kebab-case for paths)
   - Add proper descriptions and examples

2. **Before committing:**
   - Run `npm run docs:validate`
   - Run `npm run docs:lint`
   - Test in Swagger UI locally

3. **Code review checklist:**
   - âœ… No manual edits to swagger-bundled.json
   - âœ… All endpoints have security definitions
   - âœ… All schemas are properly referenced
   - âœ… Validation passes without errors

---

## ğŸ“š Resources

- [OpenAPI 3.0 Specification](https://swagger.io/specification/)
- [Swagger CLI Documentation](https://github.com/APIDevTools/swagger-cli)
- [Spectral Linting Rules](https://stoplight.io/open-source/spectral)
- [JSON Pointer Notation](https://datatracker.ietf.org/doc/html/rfc6901)

---

## ğŸ” Security Note

Ensure sensitive information (API keys, secrets) is **never** included in:
- Example values
- Descriptions
- Schema defaults

Use environment variables in actual implementation.
